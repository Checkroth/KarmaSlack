{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["import { install as sourceMapSupportInstall } from 'source-map-support';\r\nimport Express from 'express';\r\n\r\n\r\nimport Config from '../es5/config.js'; \r\n\r\nimport KarmaModel from '../es5/karma.model.js'; \r\nimport ConfigModel from '../es5/config.model.js';\r\n \r\nimport MongooseService from '../es5/mongoose.service.js';\r\nimport KarmaService from '../es5/karma.service.js'; \r\nimport ConfigService from '../es5/config.service.js'; \r\nimport SlackService from '../es5/slack.service.js'; \r\nimport ExpressService from '../es5/express.service.js'; \r\n\r\nimport KarmaRoute from '../es5/karma.route.js'; \r\n\r\nsourceMapSupportInstall();\r\n\r\nvar config = new Config();\r\n\r\nvar expressService = new ExpressService(config);\r\n\r\nvar karmaRoute = new KarmaRoute(expressService);\r\n\r\n//var app = Express();\r\n//app.use(BodyParser.urlencoded({ extended: true }));\r\n\r\n\r\n\r\nvar mongooseService = new MongooseService(config);\r\nmongooseService.init();\r\n\r\nvar karmaService = new KarmaService();\r\n\r\nexpressService.app.post('/karma',  (req, res) => {\r\n\t\r\n\t/*\r\n\tREQUEST\r\n\t\ttoken=XXXXXXXXXXXXXXXXXX\r\n\t\tteam_id=T0001\r\n\t\tteam_domain=example\r\n\t\tchannel_id=C2147483705\r\n\t\tchannel_name=test\r\n\t\ttimestamp=1355517523.000005\r\n\t\tuser_id=U2147483697\r\n\t\tuser_name=Steve\r\n\t\ttext=karma: <!everyone> ++\r\n\t\ttrigger_word=karma:\r\n\t*/\r\n\t\r\n\t//Needs to be a class\r\n\tvar slackData = {\r\n\t\ttoken: req.body.token,\r\n\t\tteamId: req.body.team_id,\r\n\t\tteamDomain: req.body.team_domain,\r\n\t\tchannelId: req.body.channel_id,\r\n\t\tchannelName: req.body.channel_name,\r\n\t\ttimestamp: req.body.timestamp,\r\n\t\tuserId: req.body.user_id,\r\n\t\tuserName: req.body.user_name,\r\n\t\toriginalText: req.body.text,\r\n\t\ttext: req.body.text.replace(req.body.trigger_word + ':', '').trim(),\r\n\t\ttriggerWord: req.body.trigger_word\r\n\t};\r\n\t\r\n\tlet configService = new ConfigService();\r\n\tlet slackService = new SlackService();\r\n\t\r\n\tlet helpPattern = /(\\?)/,\r\n\t\tinitPattern = /((init \\{)([\\s\\S]*)(\\}))/,\r\n\t\tuserIdPattern = /<@(.*?)>/,\r\n\t\tuserIdSinglePattern = /^<@(.*?)>$/,\r\n\t\tteamIdPattern = /<!everyone>/,\r\n\t\tposPattern = /((<@)(.*)(> )(\\+\\+))/,\r\n\t\tnegPattern = /((<@)(.*)(> )(\\-\\-))/;\r\n\t\r\n\t//Help\r\n\r\n\tif(helpPattern.test(slackData.text)){\r\n\t\tlet slackResponse = \"How to use karma:\";\r\n\t\tslackResponse += \"\\n Positive karma = karma: @user ++\";\r\n\t\tslackResponse += \"\\n Negative karma = karma: @user --\";\r\n\t\tslackResponse += \"\\n User karma = karma: @user\";\r\n\t\tslackResponse += \"\\n Team karma = karma: @everyone\";\r\n\t\tslackResponse += \"\\n Setup karma = karma: init {\";\r\n\t\tslackResponse += \"\\n  \\\"inboundWebhook\\\": \\\"https://hooks.slack.com/services/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\\\",\";\r\n\t\tslackResponse += \"\\n  \\\"outboundToken\\\": \\\"25LnEy4vXHEi88Plrpvg6htP\";\r\n\t\tslackResponse += \"\\n }\";\r\n\t\tslackService.sendResponse(slackData, slackResponse, res);\r\n\t}\r\n\t\r\n\t//Init\r\n\t\r\n\tif(initPattern.test(slackData.text)){\r\n\t\t\r\n\t\tlet configJsonString = slackData.text.replace(\"init\", '').trim();\r\n\t\t\r\n\t\tslackService.parseJson(configJsonString)\r\n\t\t\t.then((data)=>{\r\n\r\n\t\t\t\t//Remove the '<>' from the inbound webhook that slack seems to add around urls.\r\n\t\t\t\tdata.inboundWebhook = data.inboundWebhook.replace(/<|>/g,'');\r\n\r\n\t\t\t\tlet configModel = new ConfigModel({\r\n\t\t\t\t\tteamId: slackData.teamId,\r\n\t\t\t\t\tteamDomain: slackData.teamDomain,\r\n\t\t\t\t\t//apiToken: data.apiToken || ''\r\n\t\t\t\t\tinboundWebhook: data.inboundWebhook || '',\r\n\t\t\t\t\toutboundToken: data.outboundToken || ''\t\t\t\t\t\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconfigService.register(configModel)\r\n\t\t\t\t\t.then((data) => {\r\n\r\n\t\t\t\t\t\tslackService.sendResponse(slackData, data, res);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((data) => {\r\n\r\n\t\t\t\t\t\tslackService.sendResponse(slackData, data, res);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t}).catch(()=>{\r\n\t\t\t\tslackService.sendResponse(slackData, \"Invalid init JSON. For help see; karma: ?\", res);\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t//Positive karma\r\n\r\n\tif(posPattern.test(slackData.text)){\r\n\t\t\r\n\t\tslackService.authenticate(slackData.teamId, slackData.token).then(()=>{\r\n\r\n\t\t\tlet userId = userIdPattern.exec(slackData.text)[1];\r\n\t\t\t\r\n\t\t\tkarmaService.add(slackData.teamId, userId, slackData.userId)\r\n\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\tslackService.sendResponse(slackData, data, res);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t}).catch((err)=>{\r\n\t\t\t\r\n\t\t\tslackService.sendResponse(slackData, err, res);\r\n\t\t});\r\n\t}\r\n\t\r\n\t//Negative karma\r\n\t\r\n\tif(negPattern.test(slackData.text)){\r\n\t\t\r\n\t\tslackService.authenticate(slackData.teamId, slackData.token).then(()=>{\r\n\r\n\t\t\tlet userId = userIdPattern.exec(slackData.text)[1];\r\n\t\t\t\r\n\t\t\tkarmaService.remove(slackData.teamId, userId, slackData.userId)\r\n\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\tslackService.sendResponse(slackData, data, res);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t}).catch((err)=>{\r\n\t\t\t\r\n\t\t\tslackService.sendResponse(slackData, err, res);\r\n\t\t});\r\n\t}\r\n\t\r\n\t//User Total\r\n\t\r\n\tif(userIdSinglePattern.test(slackData.text)){\r\n\t\t\r\n\t\tslackService.authenticate(slackData.teamId, slackData.token).then(()=>{\r\n\t\t\t\r\n\t\t\tlet userId = userIdPattern.exec(slackData.text)[1];\r\n\t\t\t\r\n\t\t\tkarmaService.userCount(slackData.teamId, userId)\r\n\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\tslackService.sendResponse(slackData, data, res);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t}).catch((err)=>{\r\n\t\t\t\r\n\t\t\tslackService.sendResponse(slackData, err, res);\r\n\t\t});\r\n\t}\r\n\t\r\n\t//Team Total\r\n\t\r\n\tif(teamIdPattern.test(slackData.text)){\r\n\t\t\r\n\t\tslackService.authenticate(slackData.teamId, slackData.token).then(()=>{\r\n\t\t\t\r\n\t\t\tlet userId = teamIdPattern.exec(slackData.text)[1];\r\n\t\t\t\r\n\t\t\tkarmaService.teamCount(slackData.teamId)\r\n\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\tslackService.sendResponse(slackData, data, res);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t}).catch((err)=>{\r\n\t\t\t\r\n\t\t\tslackService.sendResponse(slackData, err, res);\r\n\t\t});\r\n\t}\r\n});\r\n\r\nexpressService.run();"],"sourceRoot":"D:\\Projects\\karma\\warm-sea-8289\\es6"}