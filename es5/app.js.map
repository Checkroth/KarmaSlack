{"version":3,"sources":["app.js"],"names":[],"mappings":";;;;gCAAmD,oBAAoB;;uBACnD,SAAS;;;;0BACN,aAAa;;;;yBAClB,YAAY;;;;2BAEX,kBAAkB;;;;+BAEd,uBAAuB;;;;gCACtB,wBAAwB;;;;oCAEpB,4BAA4B;;;;iCAC/B,yBAAyB;;;;kCACxB,0BAA0B;;;;AAEpD,sBAdS,OAAO,GAcS,CAAC;;AAE1B,IAAI,GAAG,GAAG,2BAAS,CAAC;AACpB,GAAG,CAAC,GAAG,CAAC,wBAAW,UAAU,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;;AAEnD,IAAI,MAAM,GAAG,8BAAY,CAAC;;AAE1B,IAAI,eAAe,GAAG,sCAAoB,MAAM,CAAC,CAAC;AAClD,eAAe,CAAC,IAAI,EAAE,CAAC;;AAEvB,IAAI,YAAY,GAAG,oCAAkB,CAAC;;;;;;;;;;;;;;;;;;;;;;;AAyBtC,IAAI,aAAa,GAAG,qCAAmB,CAAC;;;;;;;;;;;;;;;;;;;;;;AAuBxC,SAAS,SAAS,CAAC,GAAG,EAAC;;AAEtB,QAAO,IAAI,OAAO,CAAC,UAAC,GAAG,EAAC,GAAG,EAAI;;AAE9B,MAAG;AACF,MAAG,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;AAC9B,MAAG,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;GACrB,CAAA,OAAM,CAAC,EAAC;AACR,MAAG,EAAE,CAAC;GACN;EACD,CAAC,CAAC;CACH;;AAED,SAAS,YAAY,CAAC,MAAM,EAAE,KAAK,EAAC;;AAEnC,QAAO,IAAI,OAAO,CAAC,UAAC,GAAG,EAAC,GAAG,EAAG;;AAE7B,MAAI,aAAa,GAAG,qCAAmB,CAAC;;AAExC,eAAa,CAAC,SAAS,CAAC,MAAM,CAAC,CAC7B,IAAI,CAAC,UAAC,IAAI,EAAK;;AAEf,OAAG,CAAC,IAAI,EAAC;AACR,OAAG,CAAC,kBAAkB,CAAC,CAAC;IACxB;;AAED,OAAG,KAAK,KAAK,IAAI,CAAC,aAAa,EAAC;AAC/B,OAAG,CAAC,gBAAgB,CAAC,CAAC;IACtB;;AAED,MAAG,EAAE,CAAC;GACN,CAAC,SAAM,CAAC,UAAC,GAAG,EAAG;;AAEf,MAAG,CAAC,GAAG,CAAC,CAAC;GACT,CAAC,CAAC;EACJ,CAAC,CAAC;CACH;;AAED,SAAS,YAAY,CAAC,SAAS,EAAE,OAAO,EAAE,GAAG,EAAC;;AAE7C,KAAG,CAAC,OAAO,EAAC;AACX,SAAO,GAAG,yCAAyC,CAAC;EACpD;;;;AAID,KAAI,QAAQ,GAAG,4BAAW,CAAC;;AAE3B,cAAa,CAAC,SAAS,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,UAAC,IAAI,EAAG;;;;AAItD,MAAG,IAAI,CAAC,cAAc,EAAC;;AAEtB,WAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;;AAEzC,WAAQ,CAAC,OAAO,CAAC;;AAEf,WAAO,EAAE,GAAG,GAAG,SAAS,CAAC,WAAW;AACpC,YAAQ,EAAE,UAAU;AACpB,QAAI,EAAE,OAAO;IACd,EAAE,UAAC,GAAG,EAAE,QAAQ,EAAK;;AAEpB,WAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IACvB,CAAC,CAAC;GACH;EACD,CAAC,CAAC;CACH;;AAGD,GAAG,CAAC,IAAI,CAAC,SAAS,EAAG,UAAC,GAAG,EAAE,GAAG,EAAK;;AAElC,KAAI,cAAc,GAAG,qCAAmB,CAAC;;AAEzC,KAAI,SAAS,GAAG;AACf,OAAK,EAAE,GAAG,CAAC,IAAI,CAAC,KAAK;AACrB,QAAM,EAAE,GAAG,CAAC,IAAI,CAAC,OAAO;AACxB,YAAU,EAAE,GAAG,CAAC,IAAI,CAAC,WAAW;AAChC,WAAS,EAAE,GAAG,CAAC,IAAI,CAAC,UAAU;AAC9B,aAAW,EAAE,GAAG,CAAC,IAAI,CAAC,YAAY;AAClC,WAAS,EAAE,GAAG,CAAC,IAAI,CAAC,SAAS;AAC7B,QAAM,EAAE,GAAG,CAAC,IAAI,CAAC,OAAO;AACxB,UAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,SAAS;AAC5B,cAAY,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI;AAC3B,MAAI,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE;AAC7D,aAAW,EAAE,GAAG,CAAC,IAAI,CAAC,YAAY;EAClC,CAAC;;AAEF,KAAI,UAAU,GAAG,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;;AAE5D,KAAI,GAAG,GAAG,UAAU,CAAC,OAAO,CAAC,MAAM,EAAE,GAAI,CAAC,CAAC;AAC1C,KAAI,WAAW,GAAG,kCAAgB;AAC/B,QAAM,EAAE,SAAS,CAAC,IAAI;AACtB,YAAU,EAAE,UAAU;AACtB,gBAAc,EAAE,GAAG;AACnB,eAAa,EAAE,KAAK;EACpB,CAAC,CAAC;;AAEL,eAAc,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;AACrC,IAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;;AAGjB,UAAS,CAAC,UAAU,CAAC,CACnB,IAAI,CAAC,UAAC,IAAI,EAAG,EA+Bb,CAAC,SAAM,CAAC,YAAI,EAEZ,CAAC,CAAC;CACJ,CAAC,CAAC;;AAGH,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAG,UAAC,GAAG,EAAE,GAAG,EAAK;;;;;;;;;;;;;;;;;AAiBjC,KAAI,SAAS,GAAG;AACf,OAAK,EAAE,GAAG,CAAC,IAAI,CAAC,KAAK;AACrB,QAAM,EAAE,GAAG,CAAC,IAAI,CAAC,OAAO;AACxB,YAAU,EAAE,GAAG,CAAC,IAAI,CAAC,WAAW;AAChC,WAAS,EAAE,GAAG,CAAC,IAAI,CAAC,UAAU;AAC9B,aAAW,EAAE,GAAG,CAAC,IAAI,CAAC,YAAY;AAClC,WAAS,EAAE,GAAG,CAAC,IAAI,CAAC,SAAS;AAC7B,QAAM,EAAE,GAAG,CAAC,IAAI,CAAC,OAAO;AACxB,UAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,SAAS;AAC5B,cAAY,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI;AAC3B,MAAI,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,GAAG,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE;AACnE,aAAW,EAAE,GAAG,CAAC,IAAI,CAAC,YAAY;EAClC,CAAC;;AAEF,KAAI,aAAa,GAAG,qCAAmB,CAAC;;AAExC,KAAI,WAAW,GAAG,MAAM;KACvB,WAAW,GAAG,0BAA0B;KACxC,eAAe,GAAG,UAAU;KAC5B,WAAW,GAAG,UAAU;KACxB,UAAU,GAAG,sBAAsB;KACnC,UAAU,GAAG,sBAAsB,CAAC;;;;AAIrC,KAAG,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC;AACnC,MAAI,aAAa,GAAG,mBAAmB,CAAC;AACxC,eAAa,IAAI,qCAAqC,CAAC;AACvD,eAAa,IAAI,qCAAqC,CAAC;AACvD,eAAa,IAAI,8BAA8B,CAAC;AAChD,eAAa,IAAI,kCAAkC,CAAC;AACpD,eAAa,IAAI,gCAAgC,CAAC;AAClD,eAAa,IAAI,wGAA4G,CAAC;AAC9H,eAAa,IAAI,gDAAmD,CAAC;AACrE,eAAa,IAAI,MAAM,CAAC;AACxB,cAAY,CAAC,SAAS,EAAE,aAAa,EAAE,GAAG,CAAC,CAAC;EAC5C;;;;AAID,KAAG,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC;;AAEnC,MAAI,gBAAgB,GAAG,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;;AAEjE,WAAS,CAAC,gBAAgB,CAAC,CACzB,IAAI,CAAC,UAAC,IAAI,EAAG;;;AAGb,OAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,MAAM,EAAC,EAAE,CAAC,CAAC;;AAE7D,OAAI,WAAW,GAAG,kCAAgB;AACjC,UAAM,EAAE,SAAS,CAAC,MAAM;AACxB,cAAU,EAAE,SAAS,CAAC,UAAU;AAChC,kBAAc,EAAE,IAAI,CAAC,cAAc,IAAI,EAAE;AACzC,iBAAa,EAAE,IAAI,CAAC,aAAa,IAAI,EAAE;AACvC,YAAQ,EAAE,IAAI,CAAC,QAAQ,IAAI,EAAE;IAC7B,CAAC,CAAC;;AAEH,gBAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,CACjC,IAAI,CAAC,UAAC,IAAI,EAAK;;AAEf,gBAAY,CAAC,SAAS,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;IACnC,CAAC,SACI,CAAC,UAAC,IAAI,EAAK;;AAEhB,gBAAY,CAAC,SAAS,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;IACnC,CAAC,CAAC;GAEJ,CAAC,SAAM,CAAC,YAAI;AACZ,eAAY,CAAC,SAAS,EAAE,2CAA2C,EAAE,GAAG,CAAC,CAAC;GAC1E,CAAC,CAAC;EACJ;;;;AASD,KAAG,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC,EAuClC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,CAgDD,CAAC,CAAC;;AAEH,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EACrB;QAAM,OAAO,CAAC,GAAG,sBAAoB,MAAM,CAAC,IAAI,CAAG;CAAA,CAAC,CAAC","file":"app.js","sourcesContent":["import { install as sourceMapSupportInstall } from 'source-map-support';\r\nimport Express from 'express';\r\nimport BodyParser from 'body-parser';\r\nimport Slack from 'slack-node';\r\n\r\nimport Config from '../es5/config.js'; \r\n\r\nimport KarmaModel from '../es5/karma.model.js'; \r\nimport ConfigModel from '../es5/config.model.js';\r\n \r\nimport MongooseService from '../es5/mongoose.service.js';\r\nimport KarmaService from '../es5/karma.service.js'; \r\nimport ConfigService from '../es5/config.service.js'; \r\n\r\nsourceMapSupportInstall();\r\n\r\nvar app = Express();\r\napp.use(BodyParser.urlencoded({ extended: true }));\r\n\r\nvar config = new Config();\r\n\r\nvar mongooseService = new MongooseService(config);\r\nmongooseService.init();\r\n\r\nvar karmaService = new KarmaService();\r\n\r\n\r\n//Karma commands\r\n/*\r\nkarmaService.add(\"111\", \"DAN\", \"Craigssss\").then((data)=>{\r\n\t\r\n\tconsole.log(data);\r\n\t\r\n\tkarmaService.remove(\"111\", \"DAN\", \"ccc\").then((data)=>{\r\n\r\n\t\tconsole.log(data);\r\n\r\n\t\tkarmaService.userCount(\"111\", \"DAN\")\r\n\t\t\t.then((data) => console.log(data));\r\n\t\t\t\r\n\t\tkarmaService.teamCount(\"111\")\r\n\t\t\t.then((data) => console.log(data));\r\n\t});\r\n});\r\n*/\r\n\r\n\r\n//Regsiter\r\n\r\nvar configService = new ConfigService();\r\n\r\n//karma: init https://hooks.slack.com/services/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\r\n\r\n\r\n/*\r\nvar configModel = new ConfigModel({\r\n\tteamId: \"12345\",\r\n\tteamDomain: \"dans teamss\",\r\n\tinboundWebhook: \"https://hooks.slack.com/services/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\",\r\n\toutboundToken: \"25LnEy4vXHEi88PlrLvg6htP\"\r\n});\r\n\r\nconfigService.register(configModel)\r\n\t.then((data) => console.log(data))\r\n\t.catch((data) => console.log(data));\r\n\r\n\r\nconfigService.register(\"12345\",\"dans teamss\",\"https://hooks.slack.com/services/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\")\r\n\t.then((data) => console.log(data))\r\n\t.catch((data) => console.log(data));\r\n*/\r\n\r\nfunction parseJson(str){\r\n\t\t\r\n\treturn new Promise((res,rej) =>{\r\n\t\t\r\n\t\ttry{\r\n\t\t\tstr = str.replace(/\\\\\"/g, '');\r\n\t\t\tres(JSON.parse(str));\r\n\t\t}catch(e){\r\n\t\t\trej();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction authenticate(teamId, token){\r\n\t\t\r\n\treturn new Promise((res,rej)=>{\r\n\t\t\r\n\t\tlet configService = new ConfigService();\r\n\r\n\t\tconfigService.getConfig(teamId)\r\n\t\t\t.then((data) => {\r\n\r\n\t\t\t\tif(!data){\r\n\t\t\t\t\trej(\"No config found.\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(token !== data.outboundToken){\r\n\t\t\t\t\trej(\"Invalid token.\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tres();\t\t\t\t\r\n\t\t\t}).catch((err)=>{\r\n\r\n\t\t\t\trej(err);\r\n\t\t\t});\r\n\t});\r\n}\r\n\r\nfunction sendResponse(slackData, message, res){\r\n\t\r\n\tif(!message){\r\n\t\tmessage = \"Invalid Command. For help see; karma: ?\";\r\n\t}\r\n\t\r\n\t//res.send(message);\r\n\t\r\n\tlet slackRes = new Slack();\r\n\t\r\n\tconfigService.getConfig(slackData.teamId).then((data)=>{\r\n\t\t\r\n\t\t//data.inboundWebhook = \"https://hooks.slack.com/services/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\";\r\n\t\t\r\n\t\tif(data.inboundWebhook){\r\n\t\t\t\r\n\t\t\tslackRes.setWebhook(data.inboundWebhook);\r\n\t\t\r\n\t\t\tslackRes.webhook({\r\n\t\t\t\t\r\n\t\t\t  channel: \"#\" + slackData.channelName,\r\n\t\t\t  username: \"karmabot\",\r\n\t\t\t  text: message\r\n\t\t\t}, (err, response) => {\r\n\t\t\t\t\r\n\t\t\t  console.log(response);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\napp.post('/karma2',  (req, res) => {\r\n\t\r\n\tvar configServiceA = new ConfigService();\r\n\r\n\tvar slackData = {\r\n\t\ttoken: req.body.token,\r\n\t\tteamId: req.body.team_id,\r\n\t\tteamDomain: req.body.team_domain,\r\n\t\tchannelId: req.body.channel_id,\r\n\t\tchannelName: req.body.channel_name,\r\n\t\ttimestamp: req.body.timestamp,\r\n\t\tuserId: req.body.user_id,\r\n\t\tuserName: req.body.user_name,\r\n\t\toriginalText: req.body.text,\r\n\t\ttext: req.body.text.replace(req.body.trigger_word, '').trim(),\r\n\t\ttriggerWord: req.body.trigger_word\r\n\t};\r\n\t\r\n\tlet jsonString = slackData.text.replace(\"init\", '').trim();\r\n\r\nlet str = jsonString.replace(/\\\\\"/g, \"\\\"\");\r\n\tlet configModel = new ConfigModel({\r\n\t\t\t\tteamId: slackData.text,\r\n\t\t\t\tteamDomain: jsonString,\r\n\t\t\t\tinboundWebhook: str,\r\n\t\t\t\toutboundToken: \"444\"\r\n\t\t\t});\r\n\t\t\t\r\n\tconfigServiceA.register(configModel);\t\r\n\tres.send(\"done\");\r\n\t\r\n\t\r\n\tparseJson(jsonString)\r\n\t\t.then((data)=>{\r\n\t\t\t/*\r\n\t\t\t\tlet configModel = new ConfigModel({\r\n\t\t\t\t\t\t\tteamId: slackData.text,\r\n\t\t\t\t\t\t\tteamDomain: jsonString,\r\n\t\t\t\t\t\t\tinboundWebhook: \"333\",\r\n\t\t\t\t\t\t\toutboundToken: \"444\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\tconfigServiceA.register(configModel);\t\r\n\t\t\t\tres.send(\"done\");*/\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t//console.log(\"data 1: \" + data);\r\n\t\t\t/*let configModel = new ConfigModel({\r\n\t\t\t\tteamId: slackData.teamId,\r\n\t\t\t\tteamDomain: slackData.teamDomain,\r\n\t\t\t\tinboundWebhook: data.inboundWebhook || '',\r\n\t\t\t\toutboundToken: data.outboundToken || ''\r\n\t\t\t});\r\n\r\n\t\t\tconfigServiceA.register(configModel);*/\r\n\t\t\t\t/*.then((data) => {\r\n\t\t\t\t\t//console.log(\"data 2: \" + data);\r\n\t\t\t\t\t//sendResponse(slackData, data, res);\r\n\t\t\t\t})\r\n\t\t\t\t.catch((data) => {\r\n\t\t\t\t\t//console.log(\"data 3: \" + data);\r\n\t\t\t\t\t//sendResponse(slackData, data, res);\r\n\t\t\t\t});*/\r\n\t\t\t\t\r\n\t\t}).catch(()=>{\r\n\t\t\t//sendResponse(slackData, \"Invalid init JSON. For help see; karma: ?\", res);\r\n\t\t});\r\n});\r\n\r\n\r\napp.post('/karma',  (req, res) => {\r\n\t\r\n\t/*\r\n\tREQUEST\r\n\t\ttoken=XXXXXXXXXXXXXXXXXX\r\n\t\tteam_id=T0001\r\n\t\tteam_domain=example\r\n\t\tchannel_id=C2147483705\r\n\t\tchannel_name=test\r\n\t\ttimestamp=1355517523.000005\r\n\t\tuser_id=U2147483697\r\n\t\tuser_name=Steve\r\n\t\ttext=karma: <!everyone> ++\r\n\t\ttrigger_word=karma:\r\n\t*/\r\n\t\r\n\t//Needs to be a class\r\n\tvar slackData = {\r\n\t\ttoken: req.body.token,\r\n\t\tteamId: req.body.team_id,\r\n\t\tteamDomain: req.body.team_domain,\r\n\t\tchannelId: req.body.channel_id,\r\n\t\tchannelName: req.body.channel_name,\r\n\t\ttimestamp: req.body.timestamp,\r\n\t\tuserId: req.body.user_id,\r\n\t\tuserName: req.body.user_name,\r\n\t\toriginalText: req.body.text,\r\n\t\ttext: req.body.text.replace(req.body.trigger_word + ':', '').trim(),\r\n\t\ttriggerWord: req.body.trigger_word\r\n\t};\r\n\t\r\n\tlet configService = new ConfigService();\r\n\t\r\n\tlet helpPattern = /(\\?)/,\r\n\t\tinitPattern = /((init \\{)([\\s\\S]*)(\\}))/,\r\n\t\tuserNamePattern = /<@(.*?)>/,\r\n\t\tteamPattern = /<!(.*?)>/,\r\n\t\tposPattern = /((<@)(.*)(> )(\\+\\+))/,\r\n\t\tnegPattern = /((<@)(.*)(> )(\\-\\-))/;\r\n\t\r\n\t//Help\r\n\r\n\tif(helpPattern.test(slackData.text)){\r\n\t\tlet slackResponse = \"How to use karma:\";\r\n\t\tslackResponse += \"\\n Positive karma = karma: @user ++\";\r\n\t\tslackResponse += \"\\n Negative karma = karma: @user --\";\r\n\t\tslackResponse += \"\\n User karma = karma: @user\";\r\n\t\tslackResponse += \"\\n Team karma = karma: @everyone\";\r\n\t\tslackResponse += \"\\n Setup karma = karma: init {\";\r\n\t\tslackResponse += \"\\n  \\\"inboundWebhook\\\": \\\"https://hooks.slack.com/services/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\\\",\";\r\n\t\tslackResponse += \"\\n  \\\"outboundToken\\\": \\\"25LnEy4vXHEi88Plrpvg6htP\";\r\n\t\tslackResponse += \"\\n }\";\r\n\t\tsendResponse(slackData, slackResponse, res);\r\n\t}\r\n\t\r\n\t//Init\r\n\t\r\n\tif(initPattern.test(slackData.text)){\r\n\t\t\r\n\t\tlet configJsonString = slackData.text.replace(\"init\", '').trim();\r\n\t\t\r\n\t\tparseJson(configJsonString)\r\n\t\t\t.then((data)=>{\r\n\r\n\t\t\t\t//Remove the '<>' from the inbound webhook that slack seems to add around urls.\r\n\t\t\t\tdata.inboundWebhook = data.inboundWebhook.replace(/<|>/g,'');\r\n\r\n\t\t\t\tlet configModel = new ConfigModel({\r\n\t\t\t\t\tteamId: slackData.teamId,\r\n\t\t\t\t\tteamDomain: slackData.teamDomain,\r\n\t\t\t\t\tinboundWebhook: data.inboundWebhook || '',\r\n\t\t\t\t\toutboundToken: data.outboundToken || '',\r\n\t\t\t\t\tapiToken: data.apiToken || ''\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconfigService.register(configModel)\r\n\t\t\t\t\t.then((data) => {\r\n\r\n\t\t\t\t\t\tsendResponse(slackData, data, res);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((data) => {\r\n\r\n\t\t\t\t\t\tsendResponse(slackData, data, res);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t}).catch(()=>{\r\n\t\t\t\tsendResponse(slackData, \"Invalid init JSON. For help see; karma: ?\", res);\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t//Positive karma\r\n\t\r\n\r\n\t\r\n\r\n\t\r\n\t\r\n\tif(posPattern.test(slackData.text)){\r\n\t\t\r\n\t\t/*\r\n\t\t\t\t\tlet userName = userNamePattern.exec(slackData.text)[1];\r\n\tsendResponse(slackData, \"0.5. pos:\"+ userName, res);\r\n\t\r\n\t\tlet slackA = new Slack(\"xoxp-5035951778-5035951784-5155303862-e889d0\");\r\n\r\n\t\r\n\t\tslackA.api(\"users.list/\"+userName, function(err, response) {\r\n\r\n\t\t\tsendResponse(slackData, \"1. pos:\"+ slackData.text + ' | ' + response.user.name, res);\r\n\t\r\n\t\t\t\tkarmaService.add(slackData.teamId, response.user.name, slackData.userName)\r\n\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\tsendResponse(slackData, data, res);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t});\r\n\t\t*/\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t//sendResponse(slackData, \"2. pos:\"+ slackData.text, res);\r\n\t\t\r\n\t\t//authenticate(slackData.teamId, slackData.token).then(()=>{\r\n/*\r\n\t\t\tlet userName = userNamePattern.exec(slackData.text)[1];\r\n\t\t\t\r\n\t\t\tkarmaService.add(slackData.teamId, userName, slackData.userName)\r\n\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\tsendResponse(slackData, data, res);\r\n\t\t\t\t});\r\n*/\t\t\t\t\r\n\t\t/*}).catch((err)=>{\r\n\t\t\t\r\n\t\t\tsendResponse(slackData, err, res);\r\n\t\t});*/\r\n\t}\r\n\t\r\n\t//Negative karma\r\n/*\t\r\n\tif(negPattern.test(slackData.text)){\r\n\t\t\r\n\t\tauthenticate(slackData.teamId, slackData.token).then(()=>{\r\n\r\n\t\t\tlet userName = userNamePattern.exec(slackData.text)[1];\r\n\t\t\t\r\n\t\t\tkarmaService.remove(slackData.teamId, userName, slackData.userName)\r\n\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\tsendResponse(slackData, data, res);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t}).catch((err)=>{\r\n\t\t\t\r\n\t\t\tsendResponse(slackData, err, res);\r\n\t\t});\r\n\t}\r\n\t\r\n\t//User Total\r\n\t\r\n\tif(userNamePattern.test(slackData.text)){\r\n\t\t\r\n\t\tauthenticate(slackData.teamId, slackData.token).then(()=>{\r\n\t\t\t\r\n\t\t\tlet userName = userNamePattern.exec(slackData.text)[1];\r\n\t\t\t\r\n\t\t\tif(userName === 'everyone'){\r\n\t\t\t\t\r\n\t\t\t\tkarmaService.teamCount(slackData.teamId)\r\n\t\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\t\tsendResponse(slackData, data, res);\r\n\t\t\t\t\t});\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\t\r\n\t\t\t\tkarmaService.userCount(slackData.teamId, userName)\r\n\t\t\t\t\t.then((data)=>{\t\t\t\r\n\t\t\t\t\t\tsendResponse(slackData, data, res);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t}).catch((err)=>{\r\n\t\t\t\r\n\t\t\tsendResponse(slackData, err, res);\r\n\t\t});\r\n\t}*/\r\n});\r\n\r\napp.listen(config.port, \r\n\t() => console.log(`Running on port ${config.port}`));\r\n"],"sourceRoot":"D:\\Projects\\karma\\warm-sea-8289\\es6"}