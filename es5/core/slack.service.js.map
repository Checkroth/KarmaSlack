{"version":3,"sources":["core/slack.service.js"],"names":[],"mappings":";;;;;;;;;;;;yBAAkB,YAAY;;;;IAET,YAAY;AAErB,UAFS,YAAY,CAEpB,aAAa,EAAE,MAAM,EAAE;wBAFf,YAAY;;AAI/B,MAAI,CAAC,cAAc,GAAG,aAAa,CAAC;AACpC,MAAI,CAAC,OAAO,GAAG,MAAM,CAAC;EACtB;;cANmB,YAAY;;;;;SAUvB,mBAAC,GAAG,EAAC;;AAEb,UAAO,IAAI,OAAO,CAAC,UAAC,GAAG,EAAC,GAAG,EAAI;;AAE9B,QAAG;AACF,QAAG,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;AAC9B,QAAG,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;KACrB,CAAA,OAAM,CAAC,EAAC;AACR,QAAG,EAAE,CAAC;KACN;IACD,CAAC,CAAC;GACH;;;;;;SAIW,sBAAC,MAAM,EAAE,KAAK,EAAC;;;AAE1B,UAAO,IAAI,OAAO,CAAC,UAAC,GAAG,EAAC,GAAG,EAAG;;AAE7B,UAAK,cAAc,CAAC,SAAS,CAAC,MAAM,CAAC,CACnC,IAAI,CAAC,UAAC,IAAI,EAAK;;AAEf,SAAG,CAAC,IAAI,EAAC;AACR,SAAG,CAAC,kBAAkB,CAAC,CAAC;MACxB;;AAED,SAAG,KAAK,KAAK,IAAI,CAAC,aAAa,EAAC;AAC/B,SAAG,CAAC,gBAAgB,CAAC,CAAC;MACtB;;AAED,QAAG,EAAE,CAAC;KACN,CAAC,SAAM,CAAC,UAAC,GAAG,EAAG;;AAEf,QAAG,CAAC,GAAG,CAAC,CAAC;KACT,CAAC,CAAC;IACJ,CAAC,CAAC;GACH;;;;;;SAIW,sBAAC,SAAS,EAAE,OAAO,EAAE,GAAG,EAAC;;;AAElC,OAAG,CAAC,OAAO,EAAC;AACb,WAAO,uCAAqC,SAAS,CAAC,WAAW,QAAK,CAAC;IACvE;;AAED,OAAG,IAAI,CAAC,OAAO,CAAC,aAAa,EAAC;;;AAE7B,SAAI,QAAQ,GAAG,4BAAW,CAAC;;AAE3B,YAAK,cAAc,CAAC,SAAS,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,UAAC,IAAI,EAAG;;;;AAI5D,UAAG,IAAI,CAAC,kBAAkB,EAAC;;AAE1B,eAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;;AAE7C,eAAQ,CAAC,OAAO,CAAC;;AAEf,eAAO,EAAE,GAAG,GAAG,SAAS,CAAC,WAAW;AACpC,gBAAQ,EAAE,UAAU;AACpB,YAAI,EAAE,OAAO;QACd,EAAE,UAAC,GAAG,EAAE,QAAQ,EAAK;;AAEpB,eAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACvB,CAAC,CAAC;OACH;MACD,CAAC,CAAC;;IACH,MAAM;AACN,OAAG,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;AAC7B,WAAO;IACP;GACD;;;QAnFmB,YAAY;;;qBAAZ,YAAY","file":"core/slack.service.js","sourcesContent":["import Slack from 'slack-node';\r\n\r\nexport default class SlackService {\r\n\t\r\n\tconstructor(configService, config) {\r\n\t\t\r\n\t\tthis._configService = configService;\r\n\t\tthis._config = config;\r\n\t}\r\n\t\r\n\t//Parse json data\r\n\t\r\n\tparseJson(str){\t\r\n\t\t\t\r\n\t\treturn new Promise((res,rej) =>{\r\n\r\n\t\t\ttry{\r\n\t\t\t\tstr = str.replace(/\\\\\"/g, '');\r\n\t\t\t\tres(JSON.parse(str));\r\n\t\t\t}catch(e){\r\n\t\t\t\trej();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t//Authenticate request\r\n\t\r\n\tauthenticate(teamId, token){\r\n\r\n\t\treturn new Promise((res,rej)=>{\r\n\t\r\n\t\t\tthis._configService.getConfig(teamId)\r\n\t\t\t\t.then((data) => {\r\n\t\r\n\t\t\t\t\tif(!data){\r\n\t\t\t\t\t\trej(\"No config found.\");\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif(token !== data.outgoingToken){\r\n\t\t\t\t\t\trej(\"Invalid token.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tres();\t\t\t\t\r\n\t\t\t\t}).catch((err)=>{\r\n\t\r\n\t\t\t\t\trej(err);\r\n\t\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\t//Send slack response\r\n\t\r\n\tsendResponse(slackData, message, res){\r\n\t  \r\n\t  \tif(!message){\r\n\t\t\tmessage = `Invalid Command. For help see; ${slackData.triggerWord}: ?`;\r\n\t\t}\r\n\t\t\r\n\t\tif(this._config.productionEnv){\r\n\t\t\t\r\n\t\t\tlet slackRes = new Slack();\r\n\t\t\t\r\n\t\t\tthis._configService.getConfig(slackData.teamId).then((data)=>{\r\n\t\t\t\t\r\n\t\t\t\t//data.incomingWebhookUrl = \"https://hooks.slack.com/services/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\";\r\n\t\t\t\t\r\n\t\t\t\tif(data.incomingWebhookUrl){\r\n\t\t\t\t\t\r\n\t\t\t\t\tslackRes.setWebhook(data.incomingWebhookUrl);\r\n\t\t\t\t\r\n\t\t\t\t\tslackRes.webhook({\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t  channel: \"#\" + slackData.channelName,\r\n\t\t\t\t\t  username: \"karmabot\",\r\n\t\t\t\t\t  text: message\r\n\t\t\t\t\t}, (err, response) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t  console.log(response);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tres.send(message.toString());\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n}"],"sourceRoot":"D:\\Projects\\karma\\warm-sea-8289\\es6"}