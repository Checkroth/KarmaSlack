{"version":3,"sources":["slack.service.js"],"names":[],"mappings":";;;;;;;;;;;;yBAAkB,YAAY;;;;kCACJ,0BAA0B;;;;IAE/B,YAAY;AAErB,UAFS,YAAY,GAElB;wBAFM,YAAY;EAI/B;;cAJmB,YAAY;;;;;SAQvB,mBAAC,GAAG,EAAC;;AAEb,UAAO,IAAI,OAAO,CAAC,UAAC,GAAG,EAAC,GAAG,EAAI;;AAE9B,QAAG;AACF,QAAG,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;AAC9B,QAAG,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;KACrB,CAAA,OAAM,CAAC,EAAC;AACR,QAAG,EAAE,CAAC;KACN;IACD,CAAC,CAAC;GACH;;;;;;SAIW,sBAAC,MAAM,EAAE,KAAK,EAAC;;AAE1B,UAAO,IAAI,OAAO,CAAC,UAAC,GAAG,EAAC,GAAG,EAAG;;AAE7B,QAAI,aAAa,GAAG,qCAAmB,CAAC;;AAExC,iBAAa,CAAC,SAAS,CAAC,MAAM,CAAC,CAC7B,IAAI,CAAC,UAAC,IAAI,EAAK;;AAEf,SAAG,CAAC,IAAI,EAAC;AACR,SAAG,CAAC,kBAAkB,CAAC,CAAC;MACxB;;AAED,SAAG,KAAK,KAAK,IAAI,CAAC,aAAa,EAAC;AAC/B,SAAG,CAAC,iBAAiB,GAAG,KAAK,GAAG,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC;MAC5D;;AAED,QAAG,EAAE,CAAC;KACN,CAAC,SAAM,CAAC,UAAC,GAAG,EAAG;;AAEf,QAAG,CAAC,GAAG,CAAC,CAAC;KACT,CAAC,CAAC;IACJ,CAAC,CAAC;GACH;;;;;;SAIW,sBAAC,SAAS,EAAE,OAAO,EAAE,GAAG,EAAC;;AAElC,OAAG,CAAC,OAAO,EAAC;AACb,WAAO,GAAG,yCAAyC,CAAC;IACpD;;AAED,MAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAClB,UAAO;;AAEP,OAAI,QAAQ,GAAG,4BAAW,CAAC;AAC3B,OAAI,aAAa,GAAG,qCAAmB,CAAC;;AAExC,gBAAa,CAAC,SAAS,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,UAAC,IAAI,EAAG;;;;AAItD,QAAG,IAAI,CAAC,cAAc,EAAC;;AAEtB,aAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;;AAEzC,aAAQ,CAAC,OAAO,CAAC;;AAEf,aAAO,EAAE,GAAG,GAAG,SAAS,CAAC,WAAW;AACpC,cAAQ,EAAE,UAAU;AACpB,UAAI,EAAE,OAAO;MACd,EAAE,UAAC,GAAG,EAAE,QAAQ,EAAK;;AAEpB,aAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;MACvB,CAAC,CAAC;KACH;IACD,CAAC,CAAC;GACH;;;QAjFmB,YAAY;;;qBAAZ,YAAY","file":"slack.service.js","sourcesContent":["import Slack from 'slack-node';\r\nimport ConfigService from '../es5/config.service.js'; \r\n\r\nexport default class SlackService {\r\n\t\r\n\tconstructor() {\r\n\t\t\r\n\t}\r\n\t\r\n\t//Parse json data\r\n\t\r\n\tparseJson(str){\t\r\n\t\t\t\r\n\t\treturn new Promise((res,rej) =>{\r\n\t\t\t\r\n\t\t\ttry{\r\n\t\t\t\tstr = str.replace(/\\\\\"/g, '');\r\n\t\t\t\tres(JSON.parse(str));\r\n\t\t\t}catch(e){\r\n\t\t\t\trej();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t//Authenticate request\r\n\t\r\n\tauthenticate(teamId, token){\r\n\r\n\t\treturn new Promise((res,rej)=>{\r\n\t\t\t\r\n\t\t\tlet configService = new ConfigService();\r\n\t\r\n\t\t\tconfigService.getConfig(teamId)\r\n\t\t\t\t.then((data) => {\r\n\t\r\n\t\t\t\t\tif(!data){\r\n\t\t\t\t\t\trej(\"No config found.\");\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif(token !== data.outboundToken){\r\n\t\t\t\t\t\trej(\"Invalid token. \" + token + ' | ' + data.outboundToken);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tres();\t\t\t\t\r\n\t\t\t\t}).catch((err)=>{\r\n\t\r\n\t\t\t\t\trej(err);\r\n\t\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\t//Sentd slack response\r\n\t\r\n\tsendResponse(slackData, message, res){\r\n\t  \r\n\t  \tif(!message){\r\n\t\t\tmessage = \"Invalid Command. For help see; karma: ?\";\r\n\t\t}\r\n\t\t\r\n\t\tres.send(message);\r\n\t\treturn;\r\n\t\t\r\n\t\tlet slackRes = new Slack();\r\n\t\tlet configService = new ConfigService();\r\n\t\t\r\n\t\tconfigService.getConfig(slackData.teamId).then((data)=>{\r\n\t\t\t\r\n\t\t\t//data.inboundWebhook = \"https://hooks.slack.com/services/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\";\r\n\t\t\t\r\n\t\t\tif(data.inboundWebhook){\r\n\t\t\t\t\r\n\t\t\t\tslackRes.setWebhook(data.inboundWebhook);\r\n\t\t\t\r\n\t\t\t\tslackRes.webhook({\r\n\t\t\t\t\t\r\n\t\t\t\t  channel: \"#\" + slackData.channelName,\r\n\t\t\t\t  username: \"karmabot\",\r\n\t\t\t\t  text: message\r\n\t\t\t\t}, (err, response) => {\r\n\t\t\t\t\t\r\n\t\t\t\t  console.log(response);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}"],"sourceRoot":"D:\\Projects\\karma\\warm-sea-8289\\es6"}